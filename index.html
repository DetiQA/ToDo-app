<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>To-Do Task</title>

    <!-- PWA manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- –¶–≤—è—Ç –Ω–∞ –∞–¥—Ä–µ—Å –±–∞—Ä–∞ –Ω–∞ –º–æ–±–∏–ª–Ω–∏ –±—Ä–∞—É–∑—ä—Ä–∏ -->
    <meta name="theme-color" content="#28A745">

    <style>
       :root {
    --bg: #f4f4f4;
    --card-eng: #ffffff;
    --text: #222;
    --accent: #28a745;
    --accent-dark: #218838;
    --danger: #dc3545;
    --primary: #007bff;
    --muted: #666;
    --border: #ddd;
}

body.dark {
    --bg: #121212;
    --card-eng: #1e1e1e;
    --text: #f5f5f5;
    --accent: #4caf50;
    --accent-dark: #3c8c40;
    --danger: #ff5252;
    --primary: #66b0ff;
    --muted: #aaa;
    --border: #333;
}

/* ===== DESKTOP DEFAULT (–ù–ï –ü–ò–ü–ê–ú–ï) ===== */
body {
    font-family: Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 30px 10px;
    display: flex;
    justify-content: center;
    transition: background 0.3s ease, color 0.3s ease;
}

.container {
    background: var(--card-eng);
    padding: 20px;
    width: 100%;
    max-width: 430px; /* ‚Üê –ª–∏—Å—Ç –≤ —Ü–µ–Ω—Ç—ä—Ä–∞ */
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
    box-sizing: border-box;
}

/* ===== MOBILE FIX ‚Äî —Å—Ç–∞—Ç–∏—á–µ–Ω, —á–µ—Ç–∏–º, —Ü–µ–Ω—Ç—Ä–∏—Ä–∞–Ω –ª–∏—Å—Ç ===== */
@media (max-width: 600px) {

    html, body {
        margin: 0;
        padding: 0;
        max-width: 100%;
        overflow-x: hidden;
    }

    body {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding-top: 20px;
        background: var(--bg);
    }

    .container {
        width: 94%;          /* –º–∞–ª–∫–æ –±—è–ª–æ –ø–æ–ª–µ –æ—Ç—Å—Ç—Ä–∞–Ω–∏ */
        max-width: 420px;    /* –¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ —à–∏—Ä–æ–∫, –∑–∞ –¥–∞ —Å–µ —á–µ—Ç–µ */
        margin: 0 auto;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        box-sizing: border-box;
    }

    /* –ø–æ-–≥–æ–ª—è–º –∏ —á–µ—Ç–∏–º —Ç–µ–∫—Å—Ç */
    body, input, button, select, li {
        font-size: 18px;
    }

    h2 {
        font-size: 22px;
    }
}

/* ===== –û—Å—Ç–∞–Ω–∞–ª–∏—Ç–µ —Å—Ç–∏–ª–æ–≤–µ (–Ω–µ —Å–∞ –ø—Ä–æ–º–µ–Ω—è–Ω–∏) ===== */

.header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}

h2 {
    margin: 0;
}

#themeToggle {
    padding: 6px 10px;
    border-radius: 20px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text);
    cursor: pointer;
    font-size: 12px;
}

#themeToggle:hover {
    background: rgba(0,0,0,0.04);
}

.inputs {
    margin-top: 15px;
    display: grid;
    grid-template-columns: 1.5fr 1fr;
    grid-template-rows: auto auto;
    gap: 8px;
}

#taskInput, #deadlineInput, #categorySelect {
    padding: 8px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--text);
}

#taskInput::placeholder {
    color: var(--muted);
}

#addBtn {
    grid-column: span 2;
    padding: 9px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.2s ease, transform 0.08s ease;
}

#addBtn:hover {
    background: var(--accent-dark);
}

#addBtn:active {
    transform: scale(0.98);
}

ul {
    margin-top: 20px;
    padding: 0;
}

li {
    list-style: none;
    background: rgba(0,0,0,0.02);
    border: 1px solid var(--border);
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    cursor: grab;
    transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.2s ease, opacity 0.2s ease;
}

li.dragging {
    opacity: 0.6;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.top-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
}

.task-text {
    flex: 1;
}

.task-text span {
    word-break: break-word;
}

.task-text span.completed {
    text-decoration: line-through;
    color: #555;
}

.category-badge {
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    border: 1px solid var(--border);
    white-space: nowrap;
}

.category-Work {
    border-color: #ff9800;
    color: #ff9800;
}

.category-School {
    border-color: #3f51b5;
    color: #3f51b5;
}

.category-Personal {
    border-color: #9c27b0;
    color: #9c27b0;
}

.middle-row {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--muted);
    align-items: center;
    gap: 6px;
}

.deadline-info {
    color: red;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 4px;
}

.deadline-info.completed-deadline {
    color: #555 !important;
    font-weight: normal;
}

.countdown {
    text-align: right;
    font-size: 12px;
    color: var(--muted);
    min-width: 80px;
}

.countdown.due-soon {
    color: #ff9800;
}

.countdown.overdue {
    color: #e53935;
}

.alarm-icon {
    font-size: 16px;
    margin-left: 2px;
    color: red;
    display: inline-block;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.alarm-icon.alarm-active {
    opacity: 1;
    animation: shake 0.6s infinite;
}

.alarm-icon.completed-alarm {
    color: #555;
    opacity: 0.5;
    animation: none;
}

@keyframes shake {
    0% { transform: rotate(0deg); }
    25% { transform: rotate(10deg); }
    50% { transform: rotate(0deg); }
    75% { transform: rotate(-10deg); }
    100% { transform: rotate(0deg); }
}

.bottom-row {
    display: flex;
    justify-content: flex-end;
    gap: 6px;
}

.btn {
    padding: 4px 8px;
    border-radius: 4px;
    border: none;
    font-size: 11px;
    cursor: pointer;
}

.btn-complete {
    background: #17a2b8;
    color: white;
}

.btn-edit {
    background: #ffc107;
    color: #222;
}

.btn-delete {
    background: var(--danger);
    color: white;
}

.btn:hover {
    filter: brightness(0.95);
}

.stats {
    margin-top: 15px;
    font-size: 13px;
    color: var(--muted);
    display: flex;
    justify-content: space-between;
}

.fade-in {
    opacity: 0;
    transform: translateY(6px);
    animation: fadeIn 0.2s forwards;
}

@keyframes fadeIn {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

input.edit-input {
    width: 100%;
    border-radius: 4px;
    border: 1px solid var(--border);
    padding: 4px;
    background: transparent;
    color: var(--text);
    font-size: 12px;
}
}

/* üö´ –ü—ä–ª–Ω–∞ –∑–∞–±—Ä–∞–Ω–∞ –Ω–∞ —Ö–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–µ–Ω —Å–∫—Ä–æ–ª */
html, body {
    overflow-x: hidden !important;
    max-width: 100% !important;
}

/* üõ°Ô∏è –í—Å–∏—á–∫–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ –¥–∞ —Å–µ —Å–≤–∏–≤–∞—Ç, –≤–º–µ—Å—Ç–æ –¥–∞ —Ä–∞–∑—à–∏—Ä—è–≤–∞—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ç–∞ */
* {
    box-sizing: border-box !important;
    max-width: 100% !important;
}

/* üß© –ü—Ä–∏–Ω—É–∂–¥–∞–≤–∞–º–µ flex –µ–ª–µ–º–µ–Ω—Ç–∏—Ç–µ –¥–∞ —Å–µ –ø—Ä–µ—á—É–ø–≤–∞—Ç, –≤–º–µ—Å—Ç–æ –¥–∞ –∏–∑–±—É—Ç–≤–∞—Ç —à–∏—Ä–∏–Ω–∞—Ç–∞ */
.top-row,
.middle-row,
.bottom-row {
    flex-wrap: wrap !important;
}

/* üìù –ü—Ä–µ–Ω–∞—Å—è–Ω–µ –Ω–∞ —Ç–µ–∫—Å—Ç, –∑–∞ –¥–∞ –Ω–µ —Ä–∞–∑–¥—É–≤–∞ —à–∏—Ä–∏–Ω–∞—Ç–∞ */
.task-text span,
.category-badge,
.countdown {
    word-wrap: break-word !important;
    overflow-wrap: break-word !important;
    white-space: normal !important;
}

/* üì± MOBILE FIX ‚Äî –ø—Ä–µ–º–∞—Ö–≤–∞–º–µ flex –æ—Ç body, –∑–∞ –¥–∞ –Ω–µ ‚Äû–ø–ª—É–≤–∞‚Äú –ª–∏—Å—Ç—ä—Ç */
@media (max-width: 600px) {

    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        max-width: 100%;
        overflow-x: hidden !important;
    }

    body {
        display: block !important;   /* ‚Üê –Ω–∞–π-–≤–∞–∂–Ω–æ—Ç–æ */
        padding-top: 20px;
        background: var(--bg);
    }

    .container {
        width: 94%;
        max-width: 420px;
        margin: 0 auto;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        box-sizing: border-box;
    }

    body, input, button, select, li {
        font-size: 18px;
    }

    h2 {
        font-size: 22px;
    }
}

</style>
</head>
<body>

    </style>
</head>

<body>
<div class="container">
    <div class="header-row">
        <h2>ToDo List</h2>
        <button id="themeToggle">Dark Mode</button>
    </div>

    <div class="inputs">
        <input type="text" id="taskInput" placeholder="Input task...">

        <select id="categorySelect">
            <option value="General">General</option>
            <option value="Work">Work</option>
            <option value="School">School</option>
            <option value="Personal">Personal</option>
        </select>

        <input type="datetime-local" id="deadlineInput">
        <button id="addBtn">Add task</button>
    </div>

    <ul id="taskList"></ul>

    <div class="stats">
        <div id="statsLeft"></div>
        <div id="statsRight"></div>
    </div>
</div>

<!-- Online alarm sound -->
<audio id="alarmSound">
    <source src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" type="audio/ogg">
</audio>

<script>
const taskInput = document.getElementById("taskInput");
const categorySelect = document.getElementById("categorySelect");
const deadlineInput = document.getElementById("deadlineInput");
const addBtn = document.getElementById("addBtn");
const taskList = document.getElementById("taskList");
const themeToggle = document.getElementById("themeToggle");
const statsLeft = document.getElementById("statsLeft");
const statsRight = document.getElementById("statsRight");
const alarmSound = document.getElementById("alarmSound");

let tasks = [];
let dragSrcId = null;

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–ø—ä–ª–≤–∞–Ω–µ –Ω–∞ —Ç–µ–∫—É—â–∞—Ç–∞ –¥–∞—Ç–∞ –∏ —á–∞—Å
window.addEventListener("load", () => {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, "0");
    const day = String(now.getDate()).padStart(2, "0");
    const hours = String(now.getHours()).padStart(2, "0");
    const minutes = String(now.getMinutes()).padStart(2, "0");
    deadlineInput.value = `${year}-${month}-${day}T${hours}:${minutes}`;
});

// -------- Theme (Dark / Light) --------
function loadTheme() {
    const theme = localStorage.getItem("theme") || "light";
    if (theme === "dark") {
        document.body.classList.add("dark");
        themeToggle.textContent = "Light Mode";
    } else {
        document.body.classList.remove("dark");
        themeToggle.textContent = "Dark Mode";
    }
}

themeToggle.addEventListener("click", () => {
    const isDark = document.body.classList.toggle("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
    themeToggle.textContent = isDark ? "Light Mode" : "Dark Mode";
});

// -------- LOCALSTORAGE --------
function saveTasks() {
    localStorage.setItem("tasks", JSON.stringify(tasks));
}

function loadTasks() {
    const stored = localStorage.getItem("tasks");
    tasks = stored ? JSON.parse(stored) : [];

    tasks.forEach(t => {
        if (typeof t.alarmPlayed === "undefined") t.alarmPlayed = false;
    });

    taskList.innerHTML = "";
    tasks.forEach(t => createTaskElement(t, false));
    updateStats();
}

// -------- Statistics --------
function updateStats() {
    const total = tasks.length;
    const completed = tasks.filter(t => t.completed).length;
    const active = total - completed;
    statsLeft.textContent = `Total: ${total} | Active: ${active}`;
    statsRight.textContent = `Completed: ${completed}`;
}

// -------- Add task --------
addBtn.addEventListener("click", addTask);
taskInput.addEventListener("keydown", e => {
    if (e.key === "Enter") addTask();
});

function addTask() {
    const text = taskInput.value.trim();
    if (text === "") return;

    const category = categorySelect.value;
    const deadline = deadlineInput.value || null;

    const task = {
        id: Date.now().toString(),
        text,
        category,
        deadline,
        completed: false,
        alarmPlayed: false
    };

    tasks.push(task);
    saveTasks();
    createTaskElement(task, true);
    updateStats();

    taskInput.value = "";
    deadlineInput.value = "";
}

// -------- Create Task Element --------
function createTaskElement(task, animated) {
    const li = document.createElement("li");
    li.dataset.id = task.id;
    li.draggable = true;
    if (animated) li.classList.add("fade-in");

    // Top row
    const topRow = document.createElement("div");
    topRow.className = "top-row";

    const textDiv = document.createElement("div");
    textDiv.className = "task-text";

    const span = document.createElement("span");
    span.textContent = task.text;
    if (task.completed) span.classList.add("completed");
    span.addEventListener("dblclick", () => startEditTask(task.id, span));
    textDiv.appendChild(span);

    const catDiv = document.createElement("div");
    const catSpan = document.createElement("span");
    catSpan.className = "category-badge";
    if (task.category !== "General") {
        catSpan.classList.add(`category-${task.category}`);
    }
    catSpan.textContent = task.category;
    catDiv.appendChild(catSpan);

    topRow.appendChild(textDiv);
    topRow.appendChild(catDiv);

    // Middle row
    const middleRow = document.createElement("div");
    middleRow.className = "middle-row";

    const deadlineInfo = document.createElement("div");
    deadlineInfo.className = "deadline-info";

    let deadlineText;
    if (task.deadline) {
        const d = new Date(task.deadline);
        const formatted =
            d.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" }) +
            " " +
            d.getHours().toString().padStart(2, "0") + ":" +
            d.getMinutes().toString().padStart(2, "0");

        deadlineText = "To-do " + formatted;
    } else {
        deadlineText = "To-do  No deadline";
    }

    deadlineInfo.appendChild(document.createTextNode(deadlineText + " "));

    const alarmIcon = document.createElement("span");
    alarmIcon.className = "alarm-icon";
    alarmIcon.textContent = "‚è∞";
    deadlineInfo.appendChild(alarmIcon);

    if (task.completed) alarmIcon.style.display = "none";

    const countdownEl = document.createElement("div");
    countdownEl.className = "countdown";

    middleRow.appendChild(deadlineInfo);
    middleRow.appendChild(countdownEl);

    // Bottom row
    const bottomRow = document.createElement("div");
    bottomRow.className = "bottom-row";

    const completeBtn = document.createElement("button");
    completeBtn.className = "btn btn-complete";
    completeBtn.textContent = task.completed ? "Uncheck" : "Complete";
    completeBtn.onclick = () => toggleComplete(task.id, span, completeBtn);

    const editBtn = document.createElement("button");
    editBtn.className = "btn btn-edit";
    editBtn.textContent = "Edit";
    editBtn.onclick = () => startEditTask(task.id, span);

    const deleteBtn = document.createElement("button");
    deleteBtn.className = "btn btn-delete";
    deleteBtn.textContent = "Delete";
    deleteBtn.onclick = () => deleteTask(task.id, li);

    bottomRow.appendChild(completeBtn);
    bottomRow.appendChild(editBtn);
    bottomRow.appendChild(deleteBtn);

    li.appendChild(topRow);
    li.appendChild(middleRow);
    li.appendChild(bottomRow);

    taskList.appendChild(li);

    updateCountdownForTask(task, countdownEl, alarmIcon, deadlineInfo);
}

// -------- Countdown + Alarm --------
function updateCountdownForTask(task, countdownEl, alarmIcon, deadlineInfoEl) {
    function update() {
        if (!task.deadline) {
            countdownEl.textContent = "No deadline";
            if (alarmIcon) alarmIcon.style.display = "none";
            return;
        }

        const now = Date.now();
        const end = new Date(task.deadline).getTime();
        const diff = end - now;

        if (diff <= 0) {
            countdownEl.textContent = "Overdue";
            countdownEl.classList.add("overdue");
            if (alarmIcon) alarmIcon.style.display = "none";
            return;
        }

        const mins = Math.floor(diff / 60000);
        const hours = Math.floor(mins / 60);
        const days = Math.floor(hours / 24);

        let text;
        if (days > 0) text = `Left: ${days} days`;
        else if (hours > 0) text = `Left: ${hours} hours`;
        else text = `Left: ${mins} min`;

        countdownEl.textContent = text;

        const twoHours = 2 * 60 * 60 * 1000;

        if (task.completed) {
            alarmIcon.style.display = "none";
            return;
        }

        if (diff < twoHours) {
            alarmIcon.style.display = "inline-block";
            alarmIcon.classList.add("alarm-active");

            if (!task.alarmPlayed) {
                try {
                    alarmSound.currentTime = 0;
                    alarmSound.play();
                } catch (e) {}
                task.alarmPlayed = true;
                saveTasks();
            }
        } else {
            alarmIcon.classList.remove("alarm-active");
        }
    }

    update();
    setInterval(update, 60000);
}

// -------- Complete / Uncheck --------
function toggleComplete(id, spanEl, btn) {
    const task = tasks.find(t => t.id === id);
    if (!task) return;

    task.completed = !task.completed;

    const li = taskList.querySelector(`li[data-id="${id}"]`);
    const alarmIcon = li.querySelector(".alarm-icon");
    const deadlineInfo = li.querySelector(".deadline-info");

    if (task.completed) {
        spanEl.classList.add("completed");
        deadlineInfo.classList.add("completed-deadline");
        btn.textContent = "Uncheck";
        alarmIcon.style.display = "none";
        task.alarmPlayed = true;
    } else {
        spanEl.classList.remove("completed");
        deadlineInfo.classList.remove("completed-deadline");
        btn.textContent = "Complete";
        alarmIcon.style.display = "inline-block";
        task.alarmPlayed = false;
    }

    saveTasks();
    updateStats();
}

// -------- Edit Task --------
function startEditTask(id, spanEl) {
    const task = tasks.find(t => t.id === id);
    if (!task) return;

    const li = document.querySelector(`li[data-id="${id}"]`);
    const deadlineInfo = li.querySelector(".deadline-info");
    const catBadge = li.querySelector(".category-badge");

    const textInput = document.createElement("input");
    textInput.type = "text";
    textInput.value = task.text;
    textInput.className = "edit-input";

    const dateInput = document.createElement("input");
    dateInput.type = "datetime-local";
    dateInput.className = "edit-input";
    dateInput.value = task.deadline || "";

    const select = document.createElement("select");
    select.className = "edit-input";
    ["General", "Work", "School", "Personal"].forEach(opt => {
        const o = document.createElement("option");
        o.value = opt;
        o.textContent = opt;
        if (opt === task.category) o.selected = true;
        select.appendChild(o);
    });

    spanEl.replaceWith(textInput);
    deadlineInfo.replaceWith(dateInput);
    catBadge.replaceWith(select);

    textInput.focus();
    textInput.select();

    function finish(save) {
        if (save) {
            const newText = textInput.value.trim();
            const newDate = dateInput.value;
            const newCat = select.value;

            if (newText !== "") task.text = newText;
            task.deadline = newDate || null;
            task.category = newCat;
            task.alarmPlayed = false;

            saveTasks();
        }

        const newSpan = document.createElement("span");
        newSpan.textContent = task.text;
        if (task.completed) newSpan.classList.add("completed");
        newSpan.addEventListener("dblclick", () => startEditTask(id, newSpan));

        const newDeadlineInfo = document.createElement("div");
        newDeadlineInfo.className = "deadline-info";

        let deadlineText;
        if (task.deadline) {
            const d = new Date(task.deadline);
            const formatted =
                d.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" }) +
                " " +
                d.getHours().toString().padStart(2, "0") + ":" +
                d.getMinutes().toString().padStart(2, "0");

            deadlineText = "To-do " + formatted;
        } else {
            deadlineText = "To-do  No deadline";
        }

        newDeadlineInfo.appendChild(document.createTextNode(deadlineText + " "));

        const newAlarmIcon = document.createElement("span");
        newAlarmIcon.className = "alarm-icon";
        newAlarmIcon.textContent = "‚è∞";
        newDeadlineInfo.appendChild(newAlarmIcon);

        const newCatBadge = document.createElement("span");
        newCatBadge.className = "category-badge";
        if (task.category !== "General") {
            newCatBadge.classList.add(`category-${task.category}`);
        }
        newCatBadge.textContent = task.category;

        textInput.replaceWith(newSpan);
        dateInput.replaceWith(newDeadlineInfo);
        select.replaceWith(newCatBadge);

        const countdownEl = li.querySelector(".countdown");
        updateCountdownForTask(task, countdownEl, newAlarmIcon, newDeadlineInfo);
    }

    textInput.addEventListener("keydown", e => {
        if (e.key === "Enter") finish(true);
        if (e.key === "Escape") finish(false);
    });

    dateInput.addEventListener("keydown", e => {
        if (e.key === "Enter") finish(true);
        if (e.key === "Escape") finish(false);
    });

    select.addEventListener("keydown", e => {
        if (e.key === "Enter") finish(true);
        if (e.key === "Escape") finish(false);
    });

    textInput.addEventListener("blur", () => finish(true));
    dateInput.addEventListener("blur", () => finish(true));
}

// -------- Delete Task --------
function deleteTask(id, liEl) {
    liEl.style.opacity = "0";
    liEl.style.transform = "translateX(10px)";
    setTimeout(() => {
        tasks = tasks.filter(t => t.id !== id);
        saveTasks();
        liEl.remove();
        updateStats();
    }, 150);
}

// -------- Drag & Drop --------
taskList.addEventListener("dragstart", e => {
    const li = e.target.closest("li");
    if (!li) return;
    dragSrcId = li.dataset.id;
    li.classList.add("dragging");
});

taskList.addEventListener("dragend", e => {
    const li = e.target.closest("li");
    if (li) li.classList.remove("dragging");
});

taskList.addEventListener("dragover", e => {
    e.preventDefault();
    const dragging = taskList.querySelector(".dragging");
    if (!dragging) return;

    const afterElement = getDragAfterElement(taskList, e.clientY);
    if (afterElement == null) {
        taskList.appendChild(dragging);
    } else {
        taskList.insertBefore(dragging, afterElement);
    }
});

function getDragAfterElement(container, y) {
    const draggableElements = [...container.querySelectorAll("li:not(.dragging)")];

    return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) {
            return { offset, element: child };
        } else {
            return closest;
        }
    }, { offset: Number.NEGATIVE_INFINITY }).element;
}

taskList.addEventListener("drop", () => {
    const newOrder = [];
    taskList.querySelectorAll("li").forEach(li => {
        const id = li.dataset.id;
        const task = tasks.find(t => t.id === id);
        if (task) newOrder.push(task);
    });
    tasks = newOrder;
    saveTasks();
});

// -------- Init --------
loadTheme();
loadTasks();

// -------- Service Worker —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è --------
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker registered"))
        .catch(err => console.log("SW registration failed:", err));
}
</script>

</body>
</html>



       

















